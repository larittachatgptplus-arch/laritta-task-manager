<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laritta Task & KPI Manager - Complete System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --red-main: #c41e3a;
            --red-dark: #a01830;
            --red-lighter: #fef5f6;
            --orange: #ff6b35;
            --blue: #4285f4;
            --green: #34a853;
            --yellow: #fbbc04;
            --gray-dark: #333;
            --gray-medium: #666;
            --gray-light: #f5f5f5;
            --white: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--gray-light);
            color: var(--gray-dark);
        }

        header {
            background: linear-gradient(135deg, var(--red-main) 0%, var(--red-dark) 100%);
            color: var(--white);
            padding: 1.5rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-title h1 {
            font-size: 1.6rem;
            margin-bottom: 0.3rem;
        }

        .header-title p {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .cloud-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            font-size: 0.85rem;
        }

        .cloud-status.synced { background: rgba(52, 168, 83, 0.3); }
        .cloud-status.syncing { background: rgba(251, 188, 4, 0.3); }
        .cloud-status.error { background: rgba(234, 67, 53, 0.3); }

        .header-user select {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: 2px solid var(--white);
            background: var(--white);
            color: var(--red-dark);
            font-weight: bold;
            cursor: pointer;
            font-size: 0.9rem;
        }

        nav {
            background: var(--white);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav ul {
            max-width: 1400px;
            margin: 0 auto;
            list-style: none;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }

        nav ul li a {
            display: block;
            padding: 1rem 1.5rem;
            color: var(--red-main);
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            font-size: 0.9rem;
        }

        nav ul li a:hover,
        nav ul li a.active {
            background: var(--red-lighter);
            border-bottom-color: var(--red-main);
        }

        main {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .stat-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card.red { border-top: 4px solid var(--red-main); }
        .stat-card.blue { border-top: 4px solid var(--blue); }
        .stat-card.orange { border-top: 4px solid var(--orange); }
        .stat-card.green { border-top: 4px solid var(--green); }

        .stat-card h3 {
            font-size: 0.85rem;
            color: var(--gray-medium);
            margin-bottom: 0.75rem;
            text-transform: uppercase;
        }

        .stat-card .number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--red-main);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--red-main);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--red-dark);
        }

        .btn-secondary {
            background: var(--gray-medium);
            color: var(--white);
        }

        .btn-success {
            background: var(--green);
            color: var(--white);
        }

        .card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }

        .task-item {
            padding: 1rem;
            border-left: 4px solid var(--blue);
            margin-bottom: 1rem;
            background: var(--gray-light);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .task-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .task-item.completed {
            opacity: 0.7;
            border-left-color: var(--green);
        }

        .task-item.high-priority {
            border-left-color: var(--orange);
        }

        .task-item.overdue {
            border-left-color: var(--red-main);
            background: #fff5f5;
        }

        .task-item h3 {
            color: var(--red-main);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .task-item p {
            margin: 0.25rem 0;
            font-size: 0.9rem;
        }

        .task-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.75rem;
        }

        .tag {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .tag-type { background: var(--red-lighter); color: var(--red-main); }
        .tag-priority { background: var(--gray-light); }
        .tag-priority.high { background: var(--orange); color: white; }
        .tag-status { color: white; }
        .tag-status.todo { background: var(--blue); }
        .tag-status.in-progress { background: var(--orange); }
        .tag-status.completed { background: var(--green); }
        .tag-overdue { background: var(--red-main); color: white; }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            overflow-y: auto;
            padding: 2rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            padding: 2rem;
            border-radius: 12px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: var(--gray-dark);
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--gray-light);
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--gray-medium);
        }

        .loading-spinner {
            border: 4px solid var(--gray-light);
            border-top: 4px solid var(--red-main);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .kpi-card {
            background: linear-gradient(135deg, var(--red-main), var(--red-dark));
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }

        .kpi-score {
            font-size: 3rem;
            font-weight: bold;
            margin: 1rem 0;
        }

        .kpi-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .kpi-metric {
            background: rgba(255,255,255,0.2);
            padding: 1rem;
            border-radius: 8px;
        }

        .kpi-metric h4 {
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }

        .kpi-metric .value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .grade-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 1.5rem;
            font-weight: bold;
            margin-left: 1rem;
        }

        .grade-A { background: var(--green); }
        .grade-B { background: var(--blue); }
        .grade-C { background: var(--yellow); color: var(--gray-dark); }
        .grade-D { background: var(--orange); }

        .team-member-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid var(--red-main);
            margin-bottom: 1rem;
        }

        .team-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .team-stat {
            text-align: center;
            padding: 0.75rem;
            background: var(--gray-light);
            border-radius: 8px;
        }

        .team-stat .label {
            font-size: 0.75rem;
            color: var(--gray-medium);
            margin-bottom: 0.25rem;
        }

        .team-stat .value {
            font-size: 1.25rem;
            font-weight: bold;
            color: var(--red-main);
        }

        .schedule-options {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: var(--gray-light);
            border-radius: 8px;
        }

        .schedule-options.active {
            display: block;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            nav ul {
                flex-direction: column;
            }

            nav ul li a {
                border-bottom: 1px solid var(--gray-light);
                border-left: 3px solid transparent;
            }

            nav ul li a.active {
                border-left-color: var(--red-main);
                border-bottom-color: transparent;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="header-title">
                <h1>üç∞ LARITTA TASK & KPI MANAGER</h1>
                <p>Complete System - Real-time Cloud Sync</p>
            </div>
            <div class="cloud-status syncing" id="cloudStatus">
                <span id="statusIcon">üîÑ</span>
                <span id="statusText">Connecting...</span>
            </div>
            <div class="header-user">
                <select id="currentUser" onchange="switchUser()">
                    <option value="">Loading...</option>
                </select>
            </div>
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="#dashboard" class="nav-link active" onclick="showSection('dashboard')">üè† Dashboard</a></li>
            <li><a href="#tasks" class="nav-link" onclick="showSection('tasks')">üìã My Tasks</a></li>
            <li><a href="#kpi" class="nav-link" onclick="showSection('kpi')">üìä My KPI</a></li>
            <li><a href="#manager" class="nav-link" onclick="showSection('manager')">üëî Manager View</a></li>
            <li><a href="#team" class="nav-link" onclick="showSection('team')">üë• Team</a></li>
        </ul>
    </nav>

    <main>
        <!-- DASHBOARD SECTION -->
        <section id="dashboard" class="section active">
            <h2 style="color: var(--red-main); margin-bottom: 1.5rem;">üìä Dashboard Overview</h2>
            
            <div class="stats-grid">
                <div class="stat-card red">
                    <h3>Total Tasks</h3>
                    <div class="number" id="totalTasks">0</div>
                </div>
                <div class="stat-card blue">
                    <h3>To Do</h3>
                    <div class="number" id="todoTasks">0</div>
                </div>
                <div class="stat-card orange">
                    <h3>In Progress</h3>
                    <div class="number" id="inProgressTasks">0</div>
                </div>
                <div class="stat-card green">
                    <h3>Completed</h3>
                    <div class="number" id="completedTasks">0</div>
                </div>
                <div class="stat-card red">
                    <h3>Overdue</h3>
                    <div class="number" id="overdueTasks">0</div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-primary" onclick="showAddTaskModal()">‚ûï Add New Task</button>
            </div>
        </section>

        <!-- TASKS SECTION -->
        <section id="tasks" class="section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
                <h2 style="color: var(--red-main);">üìã My Tasks</h2>
                <button class="btn btn-primary" onclick="showAddTaskModal()">‚ûï Add Task</button>
            </div>
            
            <div class="card">
                <div id="tasksList">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading tasks...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- KPI SECTION -->
        <section id="kpi" class="section">
            <h2 style="color: var(--red-main); margin-bottom: 1.5rem;">üìä My KPI Score</h2>
            
            <div id="kpiContent">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Calculating KPI...</p>
                </div>
            </div>
        </section>

        <!-- MANAGER VIEW SECTION -->
        <section id="manager" class="section">
            <h2 style="color: var(--red-main); margin-bottom: 1.5rem;">üëî Manager Dashboard</h2>
            
            <div class="card">
                <h3 style="margin-bottom: 1rem;">Team Performance Overview</h3>
                <div id="managerStats" class="stats-grid">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading team data...</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1rem;">Performance Ranking</h3>
                <div id="performanceRanking">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Calculating rankings...</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 1rem;">Workload Distribution</h3>
                <div id="workloadDistribution">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Analyzing workload...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- TEAM SECTION -->
        <section id="team" class="section">
            <h2 style="color: var(--red-main); margin-bottom: 1.5rem;">üë• Team Members</h2>
            
            <div id="teamList">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading team...</p>
                </div>
            </div>
        </section>
    </main>

    <!-- ADD TASK MODAL -->
    <div id="addTaskModal" class="modal">
        <div class="modal-content">
            <h2 style="color: var(--red-main); margin-bottom: 1.5rem;">‚ûï Add New Task</h2>
            
            <form id="addTaskForm" onsubmit="saveTask(event)">
                <div class="form-group">
                    <label>Task Title *</label>
                    <input type="text" id="taskTitle" required placeholder="e.g., Update social media content">
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea id="taskDescription" placeholder="Task details..."></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Task Type *</label>
                        <select id="taskType" required onchange="toggleScheduleOptions()">
                            <option value="onetime">One-time Task</option>
                            <option value="daily">Daily Task</option>
                            <option value="weekly">Weekly Task</option>
                            <option value="monthly">Monthly Task</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Priority *</label>
                        <select id="taskPriority" required>
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                </div>

                <!-- One-time Task Schedule -->
                <div id="onetimeSchedule" class="schedule-options active">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Start Date *</label>
                            <input type="date" id="onetimeStartDate">
                        </div>
                        <div class="form-group">
                            <label>Due Date *</label>
                            <input type="date" id="onetimeDueDate">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Due Time</label>
                        <input type="time" id="onetimeDueTime" value="17:00">
                    </div>
                </div>

                <!-- Daily Task Schedule -->
                <div id="dailySchedule" class="schedule-options">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Start Date *</label>
                            <input type="date" id="dailyStartDate">
                        </div>
                        <div class="form-group">
                            <label>Every Day At *</label>
                            <input type="time" id="dailyTime" value="09:00">
                        </div>
                    </div>
                </div>

                <!-- Weekly Task Schedule -->
                <div id="weeklySchedule" class="schedule-options">
                    <div class="form-group">
                        <label>Start Date *</label>
                        <input type="date" id="weeklyStartDate">
                    </div>
                    <div class="form-group">
                        <label>Days of Week *</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="weekday-mon" value="1">
                                <label for="weekday-mon">Monday</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="weekday-tue" value="2">
                                <label for="weekday-tue">Tuesday</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="weekday-wed" value="3">
                                <label for="weekday-wed">Wednesday</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="weekday-thu" value="4">
                                <label for="weekday-thu">Thursday</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="weekday-fri" value="5">
                                <label for="weekday-fri">Friday</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="weekday-sat" value="6">
                                <label for="weekday-sat">Saturday</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="weekday-sun" value="0">
                                <label for="weekday-sun">Sunday</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Time *</label>
                        <input type="time" id="weeklyTime" value="09:00">
                    </div>
                </div>

                <!-- Monthly Task Schedule -->
                <div id="monthlySchedule" class="schedule-options">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Start Date *</label>
                            <input type="date" id="monthlyStartDate">
                        </div>
                        <div class="form-group">
                            <label>Day of Month (1-31) *</label>
                            <input type="number" id="monthlyDay" min="1" max="31" value="1">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Time *</label>
                        <input type="time" id="monthlyTime" value="09:00">
                    </div>
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap;">
                    <button type="submit" class="btn btn-primary">üíæ Save Task</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">‚úñÔ∏è Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- COMPLETE TASK MODAL -->
    <div id="completeTaskModal" class="modal">
        <div class="modal-content">
            <h2 style="color: var(--red-main); margin-bottom: 1.5rem;">‚úÖ Complete Task</h2>
            
            <form id="completeTaskForm" onsubmit="completeTaskWithQuality(event)">
                <input type="hidden" id="completeTaskId">
                
                <div class="form-group">
                    <label>Quality Rating *</label>
                    <select id="qualityRating" required>
                        <option value="">Select quality...</option>
                        <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excellent (5/5)</option>
                        <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê Good (4/5)</option>
                        <option value="3">‚≠ê‚≠ê‚≠ê Average (3/5)</option>
                        <option value="2">‚≠ê‚≠ê Below Average (2/5)</option>
                        <option value="1">‚≠ê Poor (1/5)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Notes (Optional)</label>
                    <textarea id="completionNotes" placeholder="Any notes about this task completion..."></textarea>
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                    <button type="submit" class="btn btn-success">‚úÖ Complete Task</button>
                    <button type="button" class="btn btn-secondary" onclick="closeCompleteModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase & App Logic -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, query, where, onSnapshot, updateDoc, deleteDoc, doc, serverTimestamp, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAdTh1Fwsp1FsyZ98yVo0X63m9Equh2d5c",
            authDomain: "laritta-task-manager.firebaseapp.com",
            projectId: "laritta-task-manager",
            storageBucket: "laritta-task-manager.firebasestorage.app",
            messagingSenderId: "408024084018",
            appId: "1:408024084018:web:8739f2654a71cdaf04962b",
            measurementId: "G-ELKPNR4B0Z"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let currentUser = 'faris';
        let tasks = [];
        let users = [];
        let kpiData = {};
        let currentTaskForCompletion = null;

        window.addEventListener('DOMContentLoaded', async () => {
            updateCloudStatus('syncing', 'Loading...');
            await initializeData();
            await loadUsers();
            await loadTasks();
            await loadKPIData();
            setupRealtimeListeners();
            setTodayDates();
            updateCloudStatus('synced', 'Synced');
        });

        function setTodayDates() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('onetimeStartDate').value = today;
            document.getElementById('dailyStartDate').value = today;
            document.getElementById('weeklyStartDate').value = today;
            document.getElementById('monthlyStartDate').value = today;
        }

        async function initializeData() {
            const usersCol = collection(db, 'users');
            const usersSnapshot = await getDocs(usersCol);
            
            if (usersSnapshot.empty) {
                const defaultUsers = [
                    { userId: 'faris', name: 'Mohammad Faris Rizal', role: 'Manager', department: 'Sales & Marketing' },
                    { userId: 'leony', name: 'Leony Hosna', role: 'PA Manager', department: 'Sales & Marketing' },
                    { userId: 'erma', name: 'Erma Sejati', role: 'Marketing', department: 'Sales & Marketing' },
                    { userId: 'dea', name: 'Amadea Wari Hidayani', role: 'Marketing', department: 'Sales & Marketing' },
                    { userId: 'sisca', name: 'Sisca', role: 'Sales Online', department: 'Sales & Marketing' },
                    { userId: 'ais', name: 'Aisyatuz Zahrah', role: 'Sales Online', department: 'Sales & Marketing' },
                    { userId: 'budo', name: 'Agus Budi', role: 'Koordinator Area', department: 'Sales & Marketing' },
                    { userId: 'naer', name: 'Nurjanah', role: 'Koordinator Area', department: 'Sales & Marketing' },
                    { userId: 'talitha', name: 'Talitha', role: 'Koordinator Area', department: 'Sales & Marketing' },
                    { userId: 'kiky', name: 'Kiky Surya Ningsih', role: 'Koordinator Area', department: 'Sales & Marketing' },
                    { userId: 'sita', name: 'Masita Krisni Adianty', role: 'Koordinator Area', department: 'Sales & Marketing' },
                    { userId: 'ira', name: 'Ita Tri Handayanie', role: 'Koordinator Area', department: 'Sales & Marketing' }
                ];

                for (const user of defaultUsers) {
                    await addDoc(collection(db, 'users'), user);
                }
            }
        }

        async function loadUsers() {
            const usersCol = collection(db, 'users');
            const usersSnapshot = await getDocs(usersCol);
            users = usersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

            const userSelect = document.getElementById('currentUser');
            userSelect.innerHTML = users.map(user => 
                `<option value="${user.userId}" ${user.userId === currentUser ? 'selected' : ''}>
                    ${user.name} (${user.role})
                </option>`
            ).join('');

            displayTeamMembers();
        }

        async function loadTasks() {
            const tasksCol = collection(db, 'tasks');
            const q = query(tasksCol, where('assignee', '==', currentUser));
            const tasksSnapshot = await getDocs(q);
            tasks = tasksSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            
            displayTasks();
            updateDashboard();
        }

        async function loadKPIData() {
            const kpiCol = collection(db, 'kpi_history');
            const kpiSnapshot = await getDocs(kpiCol);
            
            kpiData = {};
            kpiSnapshot.docs.forEach(doc => {
                const data = doc.data();
                if (!kpiData[data.userId]) {
                    kpiData[data.userId] = [];
                }
                kpiData[data.userId].push({ id: doc.id, ...data });
            });

            displayKPIScore();
            displayManagerDashboard();
        }

        function setupRealtimeListeners() {
            const tasksCol = collection(db, 'tasks');
            const q = query(tasksCol, where('assignee', '==', currentUser));
            
            onSnapshot(q, (snapshot) => {
                updateCloudStatus('syncing', 'Syncing...');
                tasks = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                displayTasks();
                updateDashboard();
                setTimeout(() => updateCloudStatus('synced', 'Synced'), 500);
            });

            const kpiCol = collection(db, 'kpi_history');
            onSnapshot(kpiCol, (snapshot) => {
                kpiData = {};
                snapshot.docs.forEach(doc => {
                    const data = doc.data();
                    if (!kpiData[data.userId]) {
                        kpiData[data.userId] = [];
                    }
                    kpiData[data.userId].push({ id: doc.id, ...data });
                });
                displayKPIScore();
                displayManagerDashboard();
            });
        }

        function displayTasks() {
            const tasksList = document.getElementById('tasksList');
            
            if (tasks.length === 0) {
                tasksList.innerHTML = '<p style="text-align: center; padding: 2rem; color: var(--gray-medium);">No tasks yet. Click "Add Task" to create one!</p>';
                return;
            }

            const now = new Date();
            const sortedTasks = tasks.sort((a, b) => {
                const dateA = new Date(a.dueDate || a.startDate);
                const dateB = new Date(b.dueDate || b.startDate);
                return dateA - dateB;
            });

            tasksList.innerHTML = sortedTasks.map(task => {
                const dueDate = task.dueDate ? new Date(task.dueDate) : null;
                const isOverdue = dueDate && dueDate < now && task.status !== 'completed';
                
                return `
                    <div class="task-item ${task.status === 'completed' ? 'completed' : ''} ${task.priority === 'high' ? 'high-priority' : ''} ${isOverdue ? 'overdue' : ''}" onclick="handleTaskClick('${task.id}', '${task.status || 'todo'}')">
                        <h3>${task.title}</h3>
                        ${task.description ? `<p>${task.description}</p>` : ''}
                        <p style="font-size: 0.85rem; color: var(--gray-medium);">
                            ${task.type === 'daily' ? 'üìÖ Daily at ' + task.schedule.time :
                              task.type === 'weekly' ? 'üìÖ Weekly on ' + getWeekdayNames(task.schedule.weekdays) + ' at ' + task.schedule.time :
                              task.type === 'monthly' ? 'üìÖ Monthly on day ' + task.schedule.monthlyDay + ' at ' + task.schedule.time :
                              'üìÖ ' + (task.startDate ? new Date(task.startDate).toLocaleDateString('id-ID') : 'No date')}
                        </p>
                        ${task.dueDate ? `<p style="font-size: 0.85rem;">‚è∞ Due: ${new Date(task.dueDate).toLocaleDateString('id-ID')} ${task.dueTime || ''}</p>` : ''}
                        <div class="task-tags">
                            <span class="tag tag-type">${task.type}</span>
                            <span class="tag tag-priority ${task.priority}">${task.priority} priority</span>
                            <span class="tag tag-status ${task.status || 'todo'}">${task.status || 'todo'}</span>
                            ${isOverdue ? '<span class="tag tag-overdue">‚ö†Ô∏è OVERDUE</span>' : ''}
                            ${task.quality ? `<span class="tag" style="background: var(--yellow);">‚≠ê ${task.quality}/5</span>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getWeekdayNames(weekdays) {
            if (!weekdays || weekdays.length === 0) return 'Not set';
            const names = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            return weekdays.map(d => names[d]).join(', ');
        }

        function updateDashboard() {
            const now = new Date();
            const overdue = tasks.filter(t => {
                if (t.status === 'completed' || !t.dueDate) return false;
                return new Date(t.dueDate) < now;
            });

            document.getElementById('totalTasks').textContent = tasks.length;
            document.getElementById('todoTasks').textContent = tasks.filter(t => !t.status || t.status === 'todo').length;
            document.getElementById('inProgressTasks').textContent = tasks.filter(t => t.status === 'in-progress').length;
            document.getElementById('completedTasks').textContent = tasks.filter(t => t.status === 'completed').length;
            document.getElementById('overdueTasks').textContent = overdue.length;
        }

        function displayKPIScore() {
            const userTasks = tasks;
            const kpi = calculateKPI(currentUser, userTasks);
            
            const kpiContent = document.getElementById('kpiContent');
            kpiContent.innerHTML = `
                <div class="kpi-card">
                    <h3 style="opacity: 0.9;">Overall KPI Score</h3>
                    <div class="kpi-score">
                        ${kpi.totalScore}
                        <span class="grade-badge grade-${kpi.grade}">${kpi.grade}</span>
                    </div>
                    <div class="kpi-metrics">
                        <div class="kpi-metric">
                            <h4>Productivity</h4>
                            <div class="value">${kpi.productivity}%</div>
                        </div>
                        <div class="kpi-metric">
                            <h4>Discipline</h4>
                            <div class="value">${kpi.discipline}%</div>
                        </div>
                        <div class="kpi-metric">
                            <h4>Quality</h4>
                            <div class="value">${kpi.quality.toFixed(1)}/5</div>
                        </div>
                        <div class="kpi-metric">
                            <h4>On-Time Rate</h4>
                            <div class="value">${kpi.onTimeRate}%</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 1rem;">Task Statistics</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                        <div class="team-stat">
                            <div class="label">Total Completed</div>
                            <div class="value">${kpi.completedTasks}</div>
                        </div>
                        <div class="team-stat">
                            <div class="label">On Time</div>
                            <div class="value" style="color: var(--green);">${kpi.onTimeTasks}</div>
                        </div>
                        <div class="team-stat">
                            <div class="label">Late</div>
                            <div class="value" style="color: var(--orange);">${kpi.lateTasks}</div>
                        </div>
                        <div class="team-stat">
                            <div class="label">Missed</div>
                            <div class="value" style="color: var(--red-main);">${kpi.missedTasks}</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 1rem;">Grade Explanation</h3>
                    <p style="margin-bottom: 0.5rem;"><strong>Grade A (85-100):</strong> Excellent performance - Consistently delivers high quality work on time</p>
                    <p style="margin-bottom: 0.5rem;"><strong>Grade B (70-84):</strong> Good performance - Meets expectations with minor delays</p>
                    <p style="margin-bottom: 0.5rem;"><strong>Grade C (55-69):</strong> Average performance - Needs improvement in timeliness or quality</p>
                    <p><strong>Grade D (0-54):</strong> Below expectations - Requires immediate attention and improvement</p>
                </div>
            `;
        }

        function calculateKPI(userId, userTasks) {
            const completed = userTasks.filter(t => t.status === 'completed');
            const total = userTasks.length;
            
            let onTime = 0, late = 0, missed = 0;
            let qualitySum = 0, qualityCount = 0;

            completed.forEach(task => {
                if (task.quality) {
                    qualitySum += parseInt(task.quality);
                    qualityCount++;
                }
                
                if (task.dueDate && task.completedAt) {
                    const dueDate = new Date(task.dueDate);
                    const completedDate = task.completedAt.toDate ? task.completedAt.toDate() : new Date(task.completedAt);
                    
                    if (completedDate <= dueDate) {
                        onTime++;
                    } else {
                        late++;
                    }
                }
            });

            const now = new Date();
            missed = userTasks.filter(t => {
                if (t.status === 'completed' || !t.dueDate) return false;
                return new Date(t.dueDate) < now;
            }).length;

            const productivity = total > 0 ? Math.round((completed.length / total) * 100) : 0;
            const discipline = (onTime + late) > 0 ? Math.round((onTime / (onTime + late)) * 100) : 0;
            const quality = qualityCount > 0 ? qualitySum / qualityCount : 0;
            const onTimeRate = (onTime + late) > 0 ? Math.round((onTime / (onTime + late)) * 100) : 0;

            let score = 0;
            score += onTime * 10;
            score += late * (-5);
            score += missed * (-10);
            score += qualitySum * 5;
            score = Math.max(0, Math.min(100, score));

            let grade = 'D';
            if (score >= 85) grade = 'A';
            else if (score >= 70) grade = 'B';
            else if (score >= 55) grade = 'C';

            return {
                totalScore: score,
                grade,
                productivity,
                discipline,
                quality,
                onTimeRate,
                completedTasks: completed.length,
                onTimeTasks: onTime,
                lateTasks: late,
                missedTasks: missed
            };
        }

        function displayManagerDashboard() {
            const managerStats = document.getElementById('managerStats');
            const performanceRanking = document.getElementById('performanceRanking');
            const workloadDistribution = document.getElementById('workloadDistribution');

            // Calculate stats for all users
            const allUserStats = users.map(user => {
                const userTasksQuery = tasks.filter(t => t.assignee === user.userId);
                const kpi = calculateKPI(user.userId, userTasksQuery);
                return {
                    ...user,
                    taskCount: userTasksQuery.length,
                    kpi
                };
            });

            // Overall stats
            const totalTasks = allUserStats.reduce((sum, u) => sum + u.taskCount, 0);
            const avgScore = allUserStats.reduce((sum, u) => sum + u.kpi.totalScore, 0) / users.length;
            const gradeA = allUserStats.filter(u => u.kpi.grade === 'A').length;
            const gradeB = allUserStats.filter(u => u.kpi.grade === 'B').length;
            const gradeC = allUserStats.filter(u => u.kpi.grade === 'C').length;
            const gradeD = allUserStats.filter(u => u.kpi.grade === 'D').length;

            managerStats.innerHTML = `
                <div class="stat-card blue">
                    <h3>Total Tasks</h3>
                    <div class="number">${totalTasks}</div>
                </div>
                <div class="stat-card green">
                    <h3>Avg Score</h3>
                    <div class="number">${avgScore.toFixed(0)}</div>
                </div>
                <div class="stat-card green">
                    <h3>Grade A</h3>
                    <div class="number">${gradeA}</div>
                </div>
                <div class="stat-card blue">
                    <h3>Grade B</h3>
                    <div class="number">${gradeB}</div>
                </div>
                <div class="stat-card orange">
                    <h3>Grade C</h3>
                    <div class="number">${gradeC}</div>
                </div>
                <div class="stat-card red">
                    <h3>Grade D</h3>
                    <div class="number">${gradeD}</div>
                </div>
            `;

            // Performance ranking
            const sorted = allUserStats.sort((a, b) => b.kpi.totalScore - a.kpi.totalScore);
            const grouped = {
                A: sorted.filter(u => u.kpi.grade === 'A'),
                B: sorted.filter(u => u.kpi.grade === 'B'),
                C: sorted.filter(u => u.kpi.grade === 'C'),
                D: sorted.filter(u => u.kpi.grade === 'D')
            };

            performanceRanking.innerHTML = Object.entries(grouped).map(([grade, members]) => `
                <div style="margin-bottom: 2rem;">
                    <h4 style="margin-bottom: 1rem; color: var(--red-main);">
                        Grade ${grade} - ${members.length} members
                    </h4>
                    ${members.map(member => `
                        <div class="team-member-card">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                                <div>
                                    <h4 style="color: var(--red-main); margin-bottom: 0.25rem;">${member.name}</h4>
                                    <p style="font-size: 0.85rem; color: var(--gray-medium);">${member.role}</p>
                                </div>
                                <span class="grade-badge grade-${grade}" style="font-size: 1.25rem;">${grade}</span>
                            </div>
                            <div class="team-stats">
                                <div class="team-stat">
                                    <div class="label">KPI Score</div>
                                    <div class="value">${member.kpi.totalScore}</div>
                                </div>
                                <div class="team-stat">
                                    <div class="label">Tasks</div>
                                    <div class="value">${member.taskCount}</div>
                                </div>
                                <div class="team-stat">
                                    <div class="label">Completed</div>
                                    <div class="value">${member.kpi.completedTasks}</div>
                                </div>
                                <div class="team-stat">
                                    <div class="label">On-Time</div>
                                    <div class="value">${member.kpi.onTimeRate}%</div>
                                </div>
                                <div class="team-stat">
                                    <div class="label">Quality</div>
                                    <div class="value">${member.kpi.quality.toFixed(1)}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `).join('');

            // Workload distribution
            const sortedByWorkload = allUserStats.sort((a, b) => b.taskCount - a.taskCount);
            workloadDistribution.innerHTML = sortedByWorkload.map(member => {
                const workloadPercentage = totalTasks > 0 ? ((member.taskCount / totalTasks) * 100).toFixed(1) : 0;
                const isHeavy = member.taskCount > (totalTasks / users.length) * 1.5;
                
                return `
                    <div class="team-member-card" style="border-left-color: ${isHeavy ? 'var(--orange)' : 'var(--blue)'};">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <div>
                                <h4 style="color: var(--red-main);">${member.name}</h4>
                                <p style="font-size: 0.85rem; color: var(--gray-medium);">${member.role}</p>
                            </div>
                            ${isHeavy ? '<span style="background: var(--orange); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">üî• High Workload</span>' : ''}
                        </div>
                        <div style="background: var(--gray-light); height: 30px; border-radius: 8px; overflow: hidden; margin-bottom: 0.5rem;">
                            <div style="background: ${isHeavy ? 'var(--orange)' : 'var(--blue)'}; height: 100%; width: ${workloadPercentage}%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.85rem;">
                                ${member.taskCount} tasks (${workloadPercentage}%)
                            </div>
                        </div>
                        <div class="team-stats">
                            <div class="team-stat">
                                <div class="label">To Do</div>
                                <div class="value">${tasks.filter(t => t.assignee === member.userId && (!t.status || t.status === 'todo')).length}</div>
                            </div>
                            <div class="team-stat">
                                <div class="label">In Progress</div>
                                <div class="value">${tasks.filter(t => t.assignee === member.userId && t.status === 'in-progress').length}</div>
                            </div>
                            <div class="team-stat">
                                <div class="label">Completed</div>
                                <div class="value">${member.kpi.completedTasks}</div>
                            </div>
                            <div class="team-stat">
                                <div class="label">Overdue</div>
                                <div class="value" style="color: var(--red-main);">${member.kpi.missedTasks}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function displayTeamMembers() {
            const teamList = document.getElementById('teamList');
            teamList.innerHTML = users.map(user => {
                const userTasksCount = tasks.filter(t => t.assignee === user.userId).length;
                const kpi = calculateKPI(user.userId, tasks.filter(t => t.assignee === user.userId));
                
                return `
                    <div class="team-member-card" style="border-left-color: ${user.userId === currentUser ? 'var(--red-main)' : 'var(--blue)'};">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <div>
                                <h3 style="color: var(--red-main); margin-bottom: 0.25rem;">${user.name}</h3>
                                <p style="font-size: 0.9rem; color: var(--gray-medium);">${user.role} - ${user.department}</p>
                            </div>
                            ${user.userId === currentUser ? '<span style="background: var(--red-main); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem;">üë§ You</span>' : ''}
                        </div>
                        <div class="team-stats">
                            <div class="team-stat">
                                <div class="label">Total Tasks</div>
                                <div class="value">${userTasksCount}</div>
                            </div>
                            <div class="team-stat">
                                <div class="label">KPI Score</div>
                                <div class="value">${kpi.totalScore}</div>
                            </div>
                            <div class="team-stat">
                                <div class="label">Grade</div>
                                <div class="value" style="color: ${kpi.grade === 'A' ? 'var(--green)' : kpi.grade === 'B' ? 'var(--blue)' : kpi.grade === 'C' ? 'var(--yellow)' : 'var(--orange)'};">${kpi.grade}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        window.saveTask = async function(event) {
            event.preventDefault();
            
            updateCloudStatus('syncing', 'Saving...');
            
            const taskType = document.getElementById('taskType').value;
            let taskData = {
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                type: taskType,
                priority: document.getElementById('taskPriority').value,
                assignee: currentUser,
                status: 'todo',
                createdAt: serverTimestamp()
            };

            // Add schedule based on type
            if (taskType === 'onetime') {
                taskData.startDate = document.getElementById('onetimeStartDate').value;
                taskData.dueDate = document.getElementById('onetimeDueDate').value;
                taskData.dueTime = document.getElementById('onetimeDueTime').value;
            } else if (taskType === 'daily') {
                taskData.startDate = document.getElementById('dailyStartDate').value;
                taskData.schedule = {
                    time: document.getElementById('dailyTime').value
                };
            } else if (taskType === 'weekly') {
                const weekdays = [];
                ['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun'].forEach((day, idx) => {
                    if (document.getElementById(`weekday-${day}`).checked) {
                        weekdays.push(parseInt(document.getElementById(`weekday-${day}`).value));
                    }
                });
                taskData.startDate = document.getElementById('weeklyStartDate').value;
                taskData.schedule = {
                    weekdays: weekdays,
                    time: document.getElementById('weeklyTime').value
                };
            } else if (taskType === 'monthly') {
                taskData.startDate = document.getElementById('monthlyStartDate').value;
                taskData.schedule = {
                    monthlyDay: parseInt(document.getElementById('monthlyDay').value),
                    time: document.getElementById('monthlyTime').value
                };
            }

            try {
                await addDoc(collection(db, 'tasks'), taskData);
                closeModal();
                document.getElementById('addTaskForm').reset();
                setTodayDates();
                updateCloudStatus('synced', 'Task saved!');
                setTimeout(() => updateCloudStatus('synced', 'Synced'), 2000);
            } catch (error) {
                console.error('Error saving task:', error);
                updateCloudStatus('error', 'Error saving');
                alert('Error saving task: ' + error.message);
            }
        };

        window.handleTaskClick = async function(taskId, currentStatus) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            if (currentStatus === 'completed') {
                if (confirm('Reopen this task?')) {
                    updateCloudStatus('syncing', 'Updating...');
                    try {
                        await updateDoc(doc(db, 'tasks', taskId), {
                            status: 'todo',
                            completedAt: null,
                            quality: null
                        });
                    } catch (error) {
                        console.error('Error:', error);
                        updateCloudStatus('error', 'Error');
                    }
                }
                return;
            }

            const action = confirm('Mark as ' + (currentStatus === 'todo' ? 'In Progress' : 'Completed') + '?');
            if (!action) return;

            if (currentStatus === 'in-progress') {
                // Show quality rating modal
                currentTaskForCompletion = taskId;
                document.getElementById('completeTaskId').value = taskId;
                document.getElementById('completeTaskModal').classList.add('active');
                return;
            }

            // Just mark as in-progress
            updateCloudStatus('syncing', 'Updating...');
            try {
                await updateDoc(doc(db, 'tasks', taskId), {
                    status: 'in-progress',
                    startedAt: serverTimestamp()
                });
            } catch (error) {
                console.error('Error:', error);
                updateCloudStatus('error', 'Error');
            }
        };

        window.completeTaskWithQuality = async function(event) {
            event.preventDefault();
            
            const taskId = document.getElementById('completeTaskId').value;
            const quality = parseInt(document.getElementById('qualityRating').value);
            const notes = document.getElementById('completionNotes').value;

            updateCloudStatus('syncing', 'Completing...');
            
            try {
                await updateDoc(doc(db, 'tasks', taskId), {
                    status: 'completed',
                    completedAt: serverTimestamp(),
                    quality: quality,
                    completionNotes: notes
                });

                // Save KPI record
                const task = tasks.find(t => t.id === taskId);
                if (task) {
                    const dueDate = task.dueDate ? new Date(task.dueDate) : null;
                    const isOnTime = dueDate ? new Date() <= dueDate : true;
                    
                    await addDoc(collection(db, 'kpi_history'), {
                        userId: currentUser,
                        taskId: taskId,
                        taskTitle: task.title,
                        completedAt: serverTimestamp(),
                        quality: quality,
                        onTime: isOnTime,
                        points: isOnTime ? 10 : -5,
                        date: new Date().toISOString().split('T')[0]
                    });
                }

                closeCompleteModal();
                updateCloudStatus('synced', 'Task completed!');
                setTimeout(() => updateCloudStatus('synced', 'Synced'), 2000);
            } catch (error) {
                console.error('Error:', error);
                updateCloudStatus('error', 'Error');
                alert('Error completing task: ' + error.message);
            }
        };

        window.toggleScheduleOptions = function() {
            const type = document.getElementById('taskType').value;
            document.querySelectorAll('.schedule-options').forEach(el => el.classList.remove('active'));
            document.getElementById(type + 'Schedule').classList.add('active');
        };

        window.switchUser = function() {
            currentUser = document.getElementById('currentUser').value;
            loadTasks();
            displayKPIScore();
            displayTeamMembers();
        };

        function updateCloudStatus(status, text) {
            const statusEl = document.getElementById('cloudStatus');
            const iconEl = document.getElementById('statusIcon');
            const textEl = document.getElementById('statusText');
            
            statusEl.className = `cloud-status ${status}`;
            textEl.textContent = text;
            
            if (status === 'synced') iconEl.textContent = '‚òÅÔ∏è';
            else if (status === 'syncing') iconEl.textContent = 'üîÑ';
            else iconEl.textContent = '‚ö†Ô∏è';
        }

        window.showSection = function(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            document.querySelector(`a[href="#${sectionId}"]`).classList.add('active');

            // Refresh manager dashboard when viewing
            if (sectionId === 'manager') {
                displayManagerDashboard();
            }
        };

        window.showAddTaskModal = function() {
            document.getElementById('addTaskModal').classList.add('active');
            toggleScheduleOptions();
        };

        window.closeModal = function() {
            document.getElementById('addTaskModal').classList.remove('active');
        };

        window.closeCompleteModal = function() {
            document.getElementById('completeTaskModal').classList.remove('active');
            document.getElementById('completeTaskForm').reset();
        };

        window.updateCloudStatus = updateCloudStatus;
    </script>
</body>
</html>
