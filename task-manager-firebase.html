<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laritta Task & KPI Manager - Firebase Cloud Sync</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --red-main: #c41e3a;
            --red-dark: #a01830;
            --red-lighter: #fef5f6;
            --orange: #ff6b35;
            --blue: #4285f4;
            --green: #34a853;
            --yellow: #fbbc04;
            --gray-dark: #333;
            --gray-medium: #666;
            --gray-light: #f5f5f5;
            --white: #ffffff;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--gray-light);
            color: var(--gray-dark);
        }

        /* HEADER */
        header {
            background: linear-gradient(135deg, var(--red-main) 0%, var(--red-dark) 100%);
            color: var(--white);
            padding: 1.5rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title h1 {
            font-size: 1.8rem;
            margin-bottom: 0.3rem;
        }

        .header-title p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .cloud-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .cloud-status.synced {
            background: rgba(52, 168, 83, 0.3);
        }

        .cloud-status.syncing {
            background: rgba(251, 188, 4, 0.3);
        }

        .cloud-status.error {
            background: rgba(234, 67, 53, 0.3);
        }

        .header-user select {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: 2px solid var(--white);
            background: var(--white);
            color: var(--red-dark);
            font-weight: bold;
            cursor: pointer;
        }

        /* NAVIGATION */
        nav {
            background: var(--white);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav ul {
            max-width: 1400px;
            margin: 0 auto;
            list-style: none;
            display: flex;
            justify-content: center;
        }

        nav ul li a {
            display: block;
            padding: 1rem 2rem;
            color: var(--red-main);
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        nav ul li a:hover,
        nav ul li a.active {
            background: var(--red-lighter);
            border-bottom-color: var(--red-main);
        }

        /* MAIN CONTENT */
        main {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* DASHBOARD */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: var(--white);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card.red {
            border-top: 4px solid var(--red-main);
        }

        .stat-card.blue {
            border-top: 4px solid var(--blue);
        }

        .stat-card.orange {
            border-top: 4px solid var(--orange);
        }

        .stat-card.green {
            border-top: 4px solid var(--green);
        }

        .stat-card h3 {
            font-size: 0.9rem;
            color: var(--gray-medium);
            margin-bottom: 1rem;
            text-transform: uppercase;
        }

        .stat-card .number {
            font-size: 3rem;
            font-weight: bold;
            color: var(--red-main);
        }

        /* BUTTONS */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--red-main);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--red-dark);
        }

        .btn-secondary {
            background: var(--gray-medium);
            color: var(--white);
        }

        .btn-success {
            background: var(--green);
            color: var(--white);
        }

        /* TASKS */
        .task-list {
            background: var(--white);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .task-item {
            padding: 1rem;
            border-left: 4px solid var(--red-main);
            margin-bottom: 1rem;
            background: var(--gray-light);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .task-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .task-item.completed {
            opacity: 0.6;
            border-left-color: var(--green);
        }

        .task-item.high-priority {
            border-left-color: var(--orange);
        }

        /* MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            padding: 2rem;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            color: var(--gray-dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--gray-light);
            border-radius: 8px;
            font-size: 1rem;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* LOADING */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--gray-medium);
        }

        .loading-spinner {
            border: 4px solid var(--gray-light);
            border-top: 4px solid var(--red-main);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header>
        <div class="header-content">
            <div class="header-title">
                <h1>üç∞ LARITTA TASK & KPI MANAGER</h1>
                <p>Real-time Cloud Sync with Firebase</p>
            </div>
            <div class="cloud-status syncing" id="cloudStatus">
                <span id="statusIcon">üîÑ</span>
                <span id="statusText">Connecting...</span>
            </div>
            <div class="header-user">
                <select id="currentUser" onchange="switchUser()">
                    <option value="">Loading users...</option>
                </select>
            </div>
        </div>
    </header>

    <!-- NAVIGATION -->
    <nav>
        <ul>
            <li><a href="#dashboard" class="nav-link active" onclick="showSection('dashboard')">üè† Dashboard</a></li>
            <li><a href="#tasks" class="nav-link" onclick="showSection('tasks')">üìã My Tasks</a></li>
            <li><a href="#team" class="nav-link" onclick="showSection('team')">üë• Team</a></li>
            <li><a href="#kpi" class="nav-link" onclick="showSection('kpi')">üìä KPI Score</a></li>
        </ul>
    </nav>

    <!-- MAIN CONTENT -->
    <main>
        <!-- DASHBOARD SECTION -->
        <section id="dashboard" class="section active">
            <h2 style="color: var(--red-main); margin-bottom: 1.5rem;">üìä Dashboard Overview</h2>
            
            <div class="stats-grid">
                <div class="stat-card red">
                    <h3>Total Tasks</h3>
                    <div class="number" id="totalTasks">0</div>
                </div>
                <div class="stat-card blue">
                    <h3>To Do</h3>
                    <div class="number" id="todoTasks">0</div>
                </div>
                <div class="stat-card orange">
                    <h3>In Progress</h3>
                    <div class="number" id="inProgressTasks">0</div>
                </div>
                <div class="stat-card green">
                    <h3>Completed</h3>
                    <div class="number" id="completedTasks">0</div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-primary" onclick="showAddTaskModal()">‚ûï Add New Task</button>
            </div>
        </section>

        <!-- TASKS SECTION -->
        <section id="tasks" class="section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2 style="color: var(--red-main);">üìã My Tasks</h2>
                <button class="btn btn-primary" onclick="showAddTaskModal()">‚ûï Add Task</button>
            </div>
            
            <div class="task-list">
                <div id="tasksList">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading tasks from Firebase...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- TEAM SECTION -->
        <section id="team" class="section">
            <h2 style="color: var(--red-main); margin-bottom: 1.5rem;">üë• Team Members</h2>
            
            <div id="teamList" class="task-list">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading team members...</p>
                </div>
            </div>
        </section>

        <!-- KPI SECTION -->
        <section id="kpi" class="section">
            <h2 style="color: var(--red-main); margin-bottom: 1.5rem;">üìä KPI Score</h2>
            
            <div class="task-list">
                <div id="kpiContent">
                    <p>Select a user to view KPI scores</p>
                </div>
            </div>
        </section>
    </main>

    <!-- ADD TASK MODAL -->
    <div id="addTaskModal" class="modal">
        <div class="modal-content">
            <h2 style="color: var(--red-main); margin-bottom: 1.5rem;">‚ûï Add New Task</h2>
            
            <form id="addTaskForm" onsubmit="saveTask(event)">
                <div class="form-group">
                    <label>Task Title *</label>
                    <input type="text" id="taskTitle" required>
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea id="taskDescription"></textarea>
                </div>

                <div class="form-group">
                    <label>Type *</label>
                    <select id="taskType" required>
                        <option value="onetime">One-time Task</option>
                        <option value="daily">Daily Task</option>
                        <option value="weekly">Weekly Task</option>
                        <option value="monthly">Monthly Task</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Priority *</label>
                    <select id="taskPriority" required>
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Deadline</label>
                    <input type="date" id="taskDeadline">
                </div>

                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button type="submit" class="btn btn-primary">üíæ Save Task</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">‚úñÔ∏è Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Import Firebase SDKs
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, query, where, onSnapshot, updateDoc, deleteDoc, doc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAdTh1Fwsp1FsyZ98yVo0X63m9Equh2d5c",
            authDomain: "laritta-task-manager.firebaseapp.com",
            projectId: "laritta-task-manager",
            storageBucket: "laritta-task-manager.firebasestorage.app",
            messagingSenderId: "408024084018",
            appId: "1:408024084018:web:8739f2654a71cdaf04962b",
            measurementId: "G-ELKPNR4B0Z"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Global variables
        let currentUser = 'faris';
        let tasks = [];
        let users = [];

        // Initialize app
        window.addEventListener('DOMContentLoaded', async () => {
            updateCloudStatus('syncing', 'Loading data...');
            await initializeData();
            await loadUsers();
            await loadTasks();
            setupRealtimeListeners();
            updateCloudStatus('synced', 'Synced');
        });

        // Initialize default users if database is empty
        async function initializeData() {
            const usersCol = collection(db, 'users');
            const usersSnapshot = await getDocs(usersCol);
            
            if (usersSnapshot.empty) {
                console.log('Initializing default users...');
                const defaultUsers = [
                    { userId: 'faris', name: 'Mohammad Faris Rizal', role: 'Manager', department: 'Sales & Marketing' },
                    { userId: 'leony', name: 'Leony Hosna', role: 'PA Manager Sales & Marketing', department: 'Sales & Marketing' },
                    { userId: 'erma', name: 'Erma Sejati', role: 'Marketing', department: 'Sales & Marketing' },
                    { userId: 'dea', name: 'Amadea Wari Hidayani', role: 'Marketing', department: 'Sales & Marketing' },
                    { userId: 'sisca', name: 'Sisca', role: 'Sales Online', department: 'Sales & Marketing' },
                    { userId: 'ais', name: 'Aisyatuz Zahrah', role: 'Sales Online', department: 'Sales & Marketing' },
                    { userId: 'budo', name: 'Agus Budi', role: 'Koordinator Area', department: 'Sales & Marketing' },
                    { userId: 'naer', name: 'Nurjanah', role: 'Koordinator Area', department: 'Sales & Marketing' },
                    { userId: 'talitha', name: 'Talitha', role: 'Koordinator Area', department: 'Sales & Marketing' },
                    { userId: 'kiky', name: 'Kiky Surya Ningsih', role: 'Koordinator Area', department: 'Sales & Marketing' },
                    { userId: 'sita', name: 'Masita Krisni Adianty', role: 'Koordinator Area', department: 'Sales & Marketing' },
                    { userId: 'ira', name: 'Ita Tri Handayanie', role: 'Koordinator Area', department: 'Sales & Marketing' }
                ];

                for (const user of defaultUsers) {
                    await addDoc(collection(db, 'users'), user);
                }
                console.log('Default users initialized!');
            }
        }

        // Load users from Firebase
        async function loadUsers() {
            const usersCol = collection(db, 'users');
            const usersSnapshot = await getDocs(usersCol);
            users = usersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

            const userSelect = document.getElementById('currentUser');
            userSelect.innerHTML = users.map(user => 
                `<option value="${user.userId}" ${user.userId === currentUser ? 'selected' : ''}>
                    ${user.name} (${user.role})
                </option>`
            ).join('');

            displayTeamMembers();
        }

        // Display team members
        function displayTeamMembers() {
            const teamList = document.getElementById('teamList');
            teamList.innerHTML = users.map(user => `
                <div class="task-item" style="border-left-color: ${user.userId === currentUser ? 'var(--red-main)' : 'var(--blue)'}">
                    <h3 style="color: var(--red-main); margin-bottom: 0.5rem;">${user.name}</h3>
                    <p><strong>Role:</strong> ${user.role}</p>
                    <p><strong>Department:</strong> ${user.department}</p>
                    ${user.userId === currentUser ? '<span style="color: var(--red-main);">üë§ You</span>' : ''}
                </div>
            `).join('');
        }

        // Load tasks from Firebase
        async function loadTasks() {
            const tasksCol = collection(db, 'tasks');
            const q = query(tasksCol, where('assignee', '==', currentUser));
            const tasksSnapshot = await getDocs(q);
            tasks = tasksSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            
            displayTasks();
            updateDashboard();
        }

        // Setup real-time listeners
        function setupRealtimeListeners() {
            const tasksCol = collection(db, 'tasks');
            const q = query(tasksCol, where('assignee', '==', currentUser));
            
            onSnapshot(q, (snapshot) => {
                updateCloudStatus('syncing', 'Syncing...');
                tasks = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                displayTasks();
                updateDashboard();
                setTimeout(() => updateCloudStatus('synced', 'Synced'), 500);
            });
        }

        // Display tasks
        function displayTasks() {
            const tasksList = document.getElementById('tasksList');
            
            if (tasks.length === 0) {
                tasksList.innerHTML = '<p style="text-align: center; padding: 2rem; color: var(--gray-medium);">No tasks yet. Click "Add Task" to create one!</p>';
                return;
            }

            tasksList.innerHTML = tasks.map(task => `
                <div class="task-item ${task.status === 'completed' ? 'completed' : ''} ${task.priority === 'high' ? 'high-priority' : ''}" onclick="toggleTask('${task.id}')">
                    <h3 style="color: var(--red-main); margin-bottom: 0.5rem;">${task.title}</h3>
                    ${task.description ? `<p style="margin-bottom: 0.5rem;">${task.description}</p>` : ''}
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 0.5rem;">
                        <span style="background: var(--red-lighter); padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.85rem;">
                            ${task.type}
                        </span>
                        <span style="background: ${task.priority === 'high' ? 'var(--orange)' : 'var(--gray-light)'}; color: ${task.priority === 'high' ? 'white' : 'inherit'}; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.85rem;">
                            ${task.priority} priority
                        </span>
                        <span style="background: ${task.status === 'completed' ? 'var(--green)' : task.status === 'in-progress' ? 'var(--orange)' : 'var(--blue)'}; color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.85rem;">
                            ${task.status || 'todo'}
                        </span>
                        ${task.deadline ? `<span>üìÖ ${new Date(task.deadline).toLocaleDateString('id-ID')}</span>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Update dashboard stats
        function updateDashboard() {
            document.getElementById('totalTasks').textContent = tasks.length;
            document.getElementById('todoTasks').textContent = tasks.filter(t => !t.status || t.status === 'todo').length;
            document.getElementById('inProgressTasks').textContent = tasks.filter(t => t.status === 'in-progress').length;
            document.getElementById('completedTasks').textContent = tasks.filter(t => t.status === 'completed').length;
        }

        // Save task to Firebase
        window.saveTask = async function(event) {
            event.preventDefault();
            
            updateCloudStatus('syncing', 'Saving...');
            
            const task = {
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDescription').value,
                type: document.getElementById('taskType').value,
                priority: document.getElementById('taskPriority').value,
                deadline: document.getElementById('taskDeadline').value,
                assignee: currentUser,
                status: 'todo',
                createdAt: serverTimestamp()
            };

            try {
                await addDoc(collection(db, 'tasks'), task);
                closeModal();
                document.getElementById('addTaskForm').reset();
                updateCloudStatus('synced', 'Task saved!');
                setTimeout(() => updateCloudStatus('synced', 'Synced'), 2000);
            } catch (error) {
                console.error('Error saving task:', error);
                updateCloudStatus('error', 'Error saving');
                alert('Error saving task. Please try again.');
            }
        };

        // Toggle task status
        window.toggleTask = async function(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;

            let newStatus;
            if (!task.status || task.status === 'todo') {
                newStatus = 'in-progress';
            } else if (task.status === 'in-progress') {
                newStatus = 'completed';
            } else {
                newStatus = 'todo';
            }

            updateCloudStatus('syncing', 'Updating...');
            
            try {
                const taskRef = doc(db, 'tasks', taskId);
                await updateDoc(taskRef, {
                    status: newStatus,
                    ...(newStatus === 'completed' && { completedAt: serverTimestamp() })
                });
            } catch (error) {
                console.error('Error updating task:', error);
                updateCloudStatus('error', 'Error updating');
            }
        };

        // Switch user
        window.switchUser = function() {
            currentUser = document.getElementById('currentUser').value;
            loadTasks();
            displayTeamMembers();
        };

        // Cloud status updates
        function updateCloudStatus(status, text) {
            const statusEl = document.getElementById('cloudStatus');
            const iconEl = document.getElementById('statusIcon');
            const textEl = document.getElementById('statusText');
            
            statusEl.className = `cloud-status ${status}`;
            textEl.textContent = text;
            
            if (status === 'synced') iconEl.textContent = '‚òÅÔ∏è';
            else if (status === 'syncing') iconEl.textContent = 'üîÑ';
            else iconEl.textContent = '‚ö†Ô∏è';
        }

        // Navigation
        window.showSection = function(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            document.querySelector(`a[href="#${sectionId}"]`).classList.add('active');
        };

        // Modal functions
        window.showAddTaskModal = function() {
            document.getElementById('addTaskModal').classList.add('active');
        };

        window.closeModal = function() {
            document.getElementById('addTaskModal').classList.remove('active');
        };

        // Export to window for global access
        window.updateCloudStatus = updateCloudStatus;
    </script>
</body>
</html>
